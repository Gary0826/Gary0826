<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">import React, { useState, useEffect, useRef } from 'react';</p>
<p class="p1">import { Sparkles, Star, Sun, Search, RotateCcw, ArrowRight, User, CloudRain, Flame, Mountain, Wind, Droplets, Moon, Compass, MapPin, Sword, Coins, CupSoda, ChevronLeft, ChevronRight, Heart, Briefcase, Activity, RefreshCw, MessageCircle, Key, ExternalLink, Settings } from 'lucide-react';</p>
<p class="p2"><br></p>
<p class="p1">// --- 資料庫 (Data Source) ---</p>
<p class="p2"><br></p>
<p class="p1">// 1. 八字基礎資料</p>
<p class="p1">const HEAVENLY_STEMS = [</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ char: '甲', element: '木', yinYang: '陽' }, { char: '乙', element: '木', yinYang: '陰' },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ char: '丙', element: '火', yinYang: '陽' }, { char: '丁', element: '火', yinYang: '陰' },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ char: '戊', element: '土', yinYang: '陽' }, { char: '己', element: '土', yinYang: '陰' },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ char: '庚', element: '金', yinYang: '陽' }, { char: '辛', element: '金', yinYang: '陰' },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ char: '壬', element: '水', yinYang: '陽' }, { char: '癸', element: '水', yinYang: '陰' }</p>
<p class="p1">];</p>
<p class="p1">const EARTHLY_BRANCHES = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];</p>
<p class="p1">const ZODIAC_ANIMALS = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'];</p>
<p class="p2"><br></p>
<p class="p1">// 2. 塔羅牌完整資料庫 (78張)</p>
<p class="p1">const generateMinorArcana = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const suits = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>{ name: '權杖', type: 'Wands', element: '火', icon: 'Flame', trait: '行動與熱情' },</p>
<p class="p1"><span class="Apple-converted-space">    </span>{ name: '聖杯', type: 'Cups', element: '水', icon: 'Droplets', trait: '情感與直覺' },</p>
<p class="p1"><span class="Apple-converted-space">    </span>{ name: '寶劍', type: 'Swords', element: '風', icon: 'Wind', trait: '思考與傷害' },</p>
<p class="p1"><span class="Apple-converted-space">    </span>{ name: '錢幣', type: 'Pentacles', element: '土', icon: 'Mountain', trait: '物質與現實' }</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p1"><span class="Apple-converted-space">  </span>const ranks = ['Ace', '2', '3', '4', '5', '6', '7', '8', '9', '10', '侍者', '騎士', '皇后', '國王'];</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const cards = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>let idCounter = 22;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>suits.forEach(suit =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>ranks.forEach((rank, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>let keywords = [];</p>
<p class="p1"><span class="Apple-converted-space">      </span>let desc_up = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>let desc_rev = "";</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>let career = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>let love = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>let health = "";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (rank === 'Ace') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>keywords = ["新的契機", "純粹能量", "靈感爆發"];</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_up = `親愛的，這是一個充滿希望的起點。${suit.element}元素的純粹能量正在您手中匯聚，宇宙為您送來了一把鑰匙。`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_rev = `能量似乎有些受阻，您可能感到有心無力，或者時機尚未成熟。別急，慢慢來。`;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if(suit.type === 'Wands') {</p>
<p class="p1"><span class="Apple-converted-space">            </span>career = "現在是啟動新專案的絕佳時機，您的熱情將感染周圍的人。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>love = "一段充滿激情的關係可能正在萌芽，或者現有關係重燃火花。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>health = "體力充沛，適合開始新的運動計畫。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if(suit.type === 'Cups') {</p>
<p class="p1"><span class="Apple-converted-space">            </span>career = "相信您的直覺，在工作中加入一點感性的創意。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>love = "打開心房，新的情感機會正在向您靠近，感受那份流動的愛。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>health = "情緒排毒的好時機，多喝水，照顧您的內分泌系統。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if(suit.type === 'Swords') {</p>
<p class="p1"><span class="Apple-converted-space">            </span>career = "一個清晰的想法或策略將突破目前的僵局。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>love = "理智的溝通能解決誤會，但要記得帶點溫度。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>health = "注意神經系統的放鬆，深呼吸是最好的藥方。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else { // Pentacles</p>
<p class="p1"><span class="Apple-converted-space">            </span>career = "實質的資源或資金即將到位，腳踏實地去做吧。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>love = "穩定的承諾，或是在關係中享受到安全感與舒適。";</p>
<p class="p1"><span class="Apple-converted-space">            </span>health = "身體狀況穩定，適合食補或接觸大自然。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>keywords = ["過程", "流動", "細節"];</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_up = `${suit.name}${rank} 代表著${suit.trait}在您生活中的展現。這張牌溫柔地提醒您，關注當下的狀態。`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_rev = `目前的能量流動稍微有些停滯或過度，可能需要重新調整步調，找回內在的平衡。`;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>career = "在工作中保持耐心，專注於細節的累積，您的努力不會白費。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>love = "關係中需要更多的包容與理解，試著站在對方的角度看事情。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>health = "留意身體發出的微小訊號，該休息的時候請不要勉強。";</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (suit.type === 'Swords' &amp;&amp; rank === '3') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>keywords = ["釋放悲傷", "療癒", "成長"];</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_up = "親愛的，我知道您現在可能感到心痛或受傷。這張牌雖然看起來令人難過，但它也代表著情緒的釋放與淨化。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>career = "職場上的失落感是暫時的，將它轉化為成長的養分。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>love = "有些話說開了雖然痛，卻是療癒的開始。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>health = "心臟與胸腔的能量需要疏通，允許自己哭泣。";</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (suit.type === 'Pentacles' &amp;&amp; rank === '5') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>keywords = ["尋求支持", "信念", "轉機"];</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_up = "您可能感到孤單或物質上的匱乏，但請抬頭看看，窗外的光一直都在。不要獨自承擔風雪。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>career = "短暫的財務緊縮或職場孤立，主動尋求幫助會帶來轉機。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>love = "不要因為不安而封閉自己，脆弱也是一種連結的力量。";</p>
<p class="p1"><span class="Apple-converted-space">        </span>health = "注意保暖與關節保養，避免過度勞累。";</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>cards.push({</p>
<p class="p1"><span class="Apple-converted-space">        </span>id: idCounter++,</p>
<p class="p1"><span class="Apple-converted-space">        </span>name: `${suit.name}${rank}`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>suit: suit.name,</p>
<p class="p1"><span class="Apple-converted-space">        </span>rank: rank,</p>
<p class="p1"><span class="Apple-converted-space">        </span>type: 'minor',</p>
<p class="p1"><span class="Apple-converted-space">        </span>element: suit.element,</p>
<p class="p1"><span class="Apple-converted-space">        </span>keywords: keywords,</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_up: desc_up,</p>
<p class="p1"><span class="Apple-converted-space">        </span>desc_rev: desc_rev,</p>
<p class="p1"><span class="Apple-converted-space">        </span>advice_career: career,</p>
<p class="p1"><span class="Apple-converted-space">        </span>advice_love: love,</p>
<p class="p1"><span class="Apple-converted-space">        </span>advice_health: health</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>return cards;</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">const MAJOR_ARCANA = [</p>
<p class="p1"><span class="Apple-converted-space">  </span>{<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>id: 0, name: "愚者", type: 'major', keywords: ["無限潛力", "歸零", "赤子之心"],<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_up: "這是一個歸零的時刻，也是宇宙送給您的禮物。像個孩子一樣，帶著好奇與信任跨出第一步吧！未知的旅程充滿了驚喜。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_rev: "親愛的，冒險是好事，但請先檢查一下背包裡的裝備。魯莽與勇氣只有一線之隔。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_career: "不要被過去的經驗束縛，大膽嘗試全新的領域或方法。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_love: "在感情中保持輕鬆與真誠，享受當下的快樂，不問未來。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_health: "注意足部健康，適合輕鬆的散步或旅行。"</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p1"><span class="Apple-converted-space">  </span>{<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>id: 1, name: "魔術師", type: 'major', keywords: ["創造力", "顯化", "資源具足"],<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_up: "看看您的周圍，您其實擁有實現夢想所需的一切資源。現在是將腦中的點子轉化為現實的最佳時刻。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_rev: "您是否感到才華無處施展？或者被表面的幻象迷惑了？請靜下心來，找回您的真實意圖。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_career: "善用您的溝通技巧與專業技能，您將成為團隊的焦點。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_love: "主動出擊，用您的魅力與幽默感去吸引對方。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_health: "神經系統與雙手靈活度是重點，適合手作或繪畫來紓壓。"</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p1"><span class="Apple-converted-space">  </span>{<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>id: 2, name: "女祭司", type: 'major', keywords: ["直覺", "內在智慧", "寧靜"],<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_up: "世界很吵雜，但您的內心知道答案。請暫時關掉外在的聲音，傾聽那來自潛意識的溫柔指引。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_rev: "您是否忽略了自己的直覺，而變得情緒化或焦慮？請找回內心的平靜。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_career: "現在不是行動的時候，而是觀察與規劃的時刻。相信您的第六感。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_love: "柏拉圖式的精神交流比肉體接觸更重要，保持一點神秘感。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_health: "適合冥想、瑜伽，調節女性荷爾蒙或內分泌系統。"</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>id: 3, name: "皇后", type: 'major', keywords: ["豐盛", "滋養", "愛"],</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_up: "您被愛與美所包圍。這張牌象徵著豐盛的收穫與感官的享受，請溫柔地對待自己。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_rev: "是否過度依賴他人，或是忘記了愛自己？請重新找回自信與獨立。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_career: "專案將開花結果，創造力源源不絕，適合與美、藝術相關的工作。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_love: "展現您的溫柔與包容，這是一段充滿滋養與承諾的關係。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_health: "注意飲食均衡，避免過度放縱，適合親近大自然。"</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>id: 4, name: "皇帝", type: 'major', keywords: ["責任", "結構", "守護"],</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_up: "您擁有掌控局面的力量。在混亂中建立秩序，成為自己生命的國王，這份堅定會帶來安全感。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>desc_rev: "是否太過固執或控制欲太強？柔軟一點，力量不在於壓制，而在於承擔。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_career: "建立明確的規則與流程，展現您的領導力與決斷力。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_love: "在關係中提供穩定的支持，但要避免大男人/大女人主義。",</p>
<p class="p1"><span class="Apple-converted-space">    </span>advice_health: "注意頭部與血壓問題，保持規律的生活作息。"</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 5, name: "教皇", type: 'major', keywords: ["指引", "信仰", "傳統"], desc_up: "尋求智慧長者的建議，或回歸傳統的價值觀，能為您帶來心靈的平靜與方向。", desc_rev: "不要盲從權威，試著打破框架，尋找屬於您自己的真理。", advice_career: "適合進修學習，或尋找職場導師（Mentor）指點迷津。", advice_love: "以結婚為前提的交往，或尋求長輩的祝福與認同。", advice_health: "頸部與喉嚨的保養，參加團體靈修或教會活動有助身心。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 6, name: "戀人", type: 'major', keywords: ["選擇", "溝通", "結合"], desc_up: "這不僅是愛情的牌，更代表價值觀的契合。傾聽內心的聲音，做出忠於自我的選擇。", desc_rev: "關係中可能出現不協調，或者面臨兩難的抉擇。誠實是唯一的解藥。", advice_career: "合作夥伴的選擇至關重要，建立互信互利的關係。", advice_love: "坦誠的溝通能化解誤會，熱戀期的甜蜜或重要的承諾。", advice_health: "注意呼吸系統與成對器官（如肺、腎）的健康。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 7, name: "戰車", type: 'major', keywords: ["意志力", "勝利", "衝刺"], desc_up: "鎖定目標，全速前進！目前的挑戰雖然艱鉅，但您的意志力足以駕馭一切，勝利在望。", desc_rev: "是否感覺失控了？衝得太快可能會翻車，請放慢速度檢查方向。", advice_career: "競爭激烈的環境，需要展現野心與執行力，克服萬難。", advice_love: "積極追求，或者在關係中克服遠距離等障礙。", advice_health: "注意消化系統與胃部，避免壓力過大導致的緊張。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 8, name: "力量", type: 'major', keywords: ["溫柔", "勇氣", "包容"], desc_up: "真正的力量不是剛硬的拳頭，而是溫柔的堅持。用愛與耐心去馴服內心的恐懼與野獸。", desc_rev: "感到軟弱或自我懷疑嗎？接納自己的脆弱，那也是力量的一部分。", advice_career: "以柔克剛，用耐心處理職場上的棘手人物或難題。", advice_love: "展現您的包容力，用溫柔化解衝突，關係更進一步。", advice_health: "心臟與脊椎的保養，保持樂觀的心情增強免疫力。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 9, name: "隱士", type: 'major', keywords: ["獨處", "內省", "明燈"], desc_up: "暫時從人群中抽離吧。獨處不是孤獨，而是為了與自己的靈魂對話，點亮內心的智慧之燈。", desc_rev: "小心不要過度封閉自己，與人連結也是生命重要的一部分。", advice_career: "適合獨立作業或進行深度研究，暫時遠離辦公室政治。", advice_love: "單身者享受獨處的自由，伴侶間需要給彼此一些空間。", advice_health: "注意眼睛與老化的問題，適合靜坐冥想。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 10, name: "命運之輪", type: 'major', keywords: ["轉變", "機運", "順流"], desc_up: "命運的輪盤轉動了，改變是唯一的不變。請順應這股流動，幸運之神正在向您微笑。", desc_rev: "或許您正在抗拒改變，覺得運氣不佳。但低谷是為了下一次的高峰。", advice_career: "意外的機會或變動出現，把握時機，適應新環境。", advice_love: "緣分天註定，可能會遇到命中注定的人，或關係進入新階段。", advice_health: "注意肝臟與循環系統，順應季節變化調整作息。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 11, name: "正義", type: 'major', keywords: ["平衡", "因果", "誠實"], desc_up: "種瓜得瓜，種豆得豆。保持客觀與公正，宇宙會給您應得的回報與真理。", desc_rev: "您是否感到不公，或正在逃避責任？誠實面對自己，才能解開心結。", advice_career: "合約簽署需謹慎，付出多少努力就有多少收穫。", advice_love: "追求平等的關係，理性溝通，避免情緒勒索。", advice_health: "腎臟與腰部的保養，維持身體的酸鹼平衡。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 12, name: "吊人", type: 'major', keywords: ["換位思考", "犧牲", "等待"], desc_up: "世界顛倒了，或許是為了讓您看清真相。暫時的停滯是為了更長遠的跳躍，請練習臣服。", desc_rev: "無謂的犧牲只會帶來痛苦，請設立停損點，不要再鑽牛角尖。", advice_career: "工作可能陷入瓶頸，試著換個角度思考，或暫時以退為進。", advice_love: "為愛付出是美好的，但不要失去自我。等待時機成熟。", advice_health: "注意足部與淋巴循環，適合瑜伽或伸展運動。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 13, name: "死神", type: 'major', keywords: ["結束", "重生", "斷捨離"], desc_up: "別害怕，結束是新生的開始。徹底告別那些不再服務於您的舊模式，迎接蛻變後的自己。", desc_rev: "抗拒改變只會延長痛苦。放手吧，讓該走的走，光才能照進來。", advice_career: "轉換跑道、離職或結束一個專案。這是轉型的必經之路。", advice_love: "一段關係的結束或轉化，告別過去的傷痛。", advice_health: "排毒、清理身體廢物，骨骼與牙齒的健康。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 14, name: "節制", type: 'major', keywords: ["調和", "療癒", "中庸"], desc_up: "像水與火的交融，尋找生命中的平衡點。不急不徐，透過溝通與協調，療癒將會發生。", desc_rev: "生活失衡了嗎？情緒起伏過大或過度揮霍，請找回內心的中心點。", advice_career: "擔任協調者的角色，在多方意見中尋求共識。", advice_love: "細水長流的感情，互相適應與包容，心靈契合。", advice_health: "注意體液循環與泌尿系統，保持身心靈的平衡。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 15, name: "惡魔", type: 'major', keywords: ["慾望", "束縛", "覺察"], desc_up: "看見那些綑綁您的恐懼與慾望。鎖鏈其實是鬆的，只要您願意面對陰影，就能重獲自由。", desc_rev: "覺醒的時刻到了！您已經準備好擺脫那些不健康的依賴關係。", advice_career: "小心職場上的誘惑或不道德的交易，不要為了錢出賣靈魂。", advice_love: "避免強烈佔有慾或窒息的愛，釐清是愛還是執著。", advice_health: "注意成癮問題（菸酒、糖分），皮膚與生殖系統健康。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 16, name: "高塔", type: 'major', keywords: ["崩解", "啟示", "重健"], desc_up: "突如其來的改變雖然令人震驚，但它震垮了虛假的謊言。擁抱這份破壞，在廢墟上重建真實。", desc_rev: "勉強維持現狀只是在拖延時間。長痛不如短痛，勇敢面對真相吧。", advice_career: "公司或職位可能發生劇變，危機就是轉機，打掉重練。", advice_love: "關係中的未爆彈引爆，雖然痛苦卻能看清現實。", advice_health: "注意突發性的意外或發炎，避免過度勞累。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 17, name: "星星", type: 'major', keywords: ["希望", "靈感", "淨化"], desc_up: "黑夜中最亮的那顆星，指引著方向。經過了風雨，寧靜與希望降臨，請相信宇宙的安排。", desc_rev: "感到氣餒或缺乏信心嗎？星星從未消失，只是暫時被雲遮住了。", advice_career: "充滿創意與靈感，從事理想中的工作，未來充滿希望。", advice_love: "靈魂伴侶的出現，或對關係重燃希望，純純的愛。", advice_health: "身心靈的療癒期，適合水療或接觸大自然。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 18, name: "月亮", type: 'major', keywords: ["不安", "潛意識", "夢境"], desc_up: "前路朦朧，恐懼在陰影中滋長。這是一段探索潛意識的旅程，相信您的直覺，等待迷霧散去。", desc_rev: "秘密被揭露，或者您終於看清了真相。不再被恐懼綁架。", advice_career: "局勢不明朗，小心職場上的流言蜚語或欺騙。", advice_love: "關係中可能存在隱瞞或不安，需要釐清真實的感受。", advice_health: "注意睡眠品質與婦科問題，情緒波動影響身體。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 19, name: "太陽", type: 'major', keywords: ["喜悅", "成功", "活力"], desc_up: "像太陽一樣發光發熱吧！所有的陰霾都已散去，盡情享受這份單純的快樂與成功。", desc_rev: "雖然成功稍微延遲，但光明終將到來。或者提醒您不要過度自信。", advice_career: "工作表現亮眼，獲得升遷或表揚，充滿自信與活力。", advice_love: "熱情洋溢的戀情，公開的關係，幸福美滿。", advice_health: "心臟與心血管健康，多曬太陽，保持活力。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 20, name: "審判", type: 'major', keywords: ["覺醒", "召喚", "決斷"], desc_up: "聽到了嗎？那是來自靈魂的召喚。過去的經驗都是養分，現在是做出重大決定、邁向新階段的時刻。", desc_rev: "您是否在拒絕成長？放下過去的悔恨與包袱，原諒自己，向前走。", advice_career: "面臨轉職或生涯規劃的關鍵時刻，回應內心的聲音。", advice_love: "舊情復燃的機會，或關係來到關鍵的轉折點。", advice_health: "身體機能的復甦與再生，適合進行全身檢查。" },</p>
<p class="p1"><span class="Apple-converted-space">  </span>{ id: 21, name: "世界", type: 'major', keywords: ["圓滿", "整合", "新旅程"], desc_up: "恭喜您，旅程到達了完美的終點。享受這份成就感與完整，同時準備迎接下一個更高層次的開始。", desc_rev: "感覺還差臨門一腳？別急，耐心地完成最後的拼圖，圓滿即將到來。", advice_career: "專案完美收官，達成目標，或有外派、出國發展的機會。", advice_love: "修成正果，彼此是身心靈契合的伴侶。", advice_health: "身心靈達到最佳平衡狀態，健康充滿活力。" }</p>
<p class="p1">];</p>
<p class="p2"><br></p>
<p class="p1">const TAROT_DECK = [...MAJOR_ARCANA, ...generateMinorArcana()];</p>
<p class="p2"><br></p>
<p class="p1">// --- 精準演算法區 (Algorithms) ---</p>
<p class="p2"><br></p>
<p class="p1">const calculateBazi = (year, month, day) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>let baziYear = year;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (month === 1 || (month === 2 &amp;&amp; day &lt; 4)) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>baziYear = year - 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>const stemIndex = (baziYear - 3) % 10;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const displayStemIndex = stemIndex &lt; 0 ? stemIndex + 10 : stemIndex;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const branchIndex = (baziYear - 3) % 12;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const displayBranchIndex = branchIndex &lt; 0 ? branchIndex + 12 : branchIndex;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>return {</p>
<p class="p1"><span class="Apple-converted-space">    </span>stem: HEAVENLY_STEMS[displayStemIndex],</p>
<p class="p1"><span class="Apple-converted-space">    </span>branch: EARTHLY_BRANCHES[displayBranchIndex],</p>
<p class="p1"><span class="Apple-converted-space">    </span>animal: ZODIAC_ANIMALS[displayBranchIndex],</p>
<p class="p1"><span class="Apple-converted-space">    </span>realYear: baziYear</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// 精準上升星座算法 (Improved Astronomical Calculation)</p>
<p class="p1">const calculateRisingSign = (year, month, day, hour, minute) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>let y = year;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let m = month;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (m &lt; 3) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>y -= 1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>m += 12;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>let utch = hour - 8 + (minute / 60.0);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const A = Math.floor(y / 100);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const B = 2 - A + Math.floor(A / 4);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const JD_day = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day + B - 1524.5;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const JD = JD_day + utch / 24.0;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const T = (JD - 2451545.0) / 36525.0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let GMST = 280.46061837 + 360.98564736629 * (JD - 2451545.0) + 0.000387933 * T * T - T * T * T / 38710000.0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>GMST = ((GMST % 360) + 360) % 360;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const Longitude = 121.5;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const Latitude = 25.05;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>let LMST = GMST + Longitude;</p>
<p class="p1"><span class="Apple-converted-space">  </span>LMST = ((LMST % 360) + 360) % 360;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const Obliquity = 23.4393 - 0.0130042 * T;<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const D2R = Math.PI / 180;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const R2D = 180 / Math.PI;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const ramcRad = LMST * D2R;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const latRad = Latitude * D2R;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const oblRad = Obliquity * D2R;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const yVal = Math.cos(ramcRad);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const xVal = -Math.sin(ramcRad) * Math.cos(oblRad) + Math.tan(latRad) * Math.sin(oblRad);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>let asc = Math.atan2(yVal, xVal) * R2D;</p>
<p class="p1"><span class="Apple-converted-space">  </span>asc = ((asc % 360) + 360) % 360;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const signs = [</p>
<p class="p1"><span class="Apple-converted-space">      </span>"牡羊座", "金牛座", "雙子座", "巨蟹座", "獅子座", "處女座",</p>
<p class="p1"><span class="Apple-converted-space">      </span>"天秤座", "天蠍座", "射手座", "摩羯座", "水瓶座", "雙魚座"</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>return signs[Math.floor(asc / 30)];</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// 精準月亮星座算法 (Approximate position of Moon)</p>
<p class="p1">const calculateMoonSign = (year, month, day, hour, minute) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>let y = year;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let m = month;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (m &lt; 3) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>y -= 1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>m += 12;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>let utch = hour - 8 + (minute / 60.0);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const A = Math.floor(y / 100);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const B = 2 - A + Math.floor(A / 4);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const JD_day = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day + B - 1524.5;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const JD = JD_day + utch / 24.0;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const T = (JD - 2451545.0) / 36525.0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const D2R = Math.PI / 180;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Mean elements of Moon</p>
<p class="p1"><span class="Apple-converted-space">  </span>let L0 = 218.3164477 + 481267.8812542 * T;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let D = 297.8501955 + 445267.1114800 * T;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let M = 357.5291092 + 35999.0503400 * T;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let M_prime = 134.9633964 + 477198.8673981 * T;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let F = 93.2720950 + 483202.0175381 * T;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Major periodic terms corrections for Longitude</p>
<p class="p1"><span class="Apple-converted-space">  </span>let L = L0<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>+ 6.2888 * Math.sin(M_prime * D2R)</p>
<p class="p1"><span class="Apple-converted-space">        </span>+ 1.2740 * Math.sin((2 * D - M_prime) * D2R)</p>
<p class="p1"><span class="Apple-converted-space">        </span>+ 0.6583 * Math.sin(2 * D * D2R)</p>
<p class="p1"><span class="Apple-converted-space">        </span>+ 0.2136 * Math.sin(2 * M_prime * D2R)</p>
<p class="p1"><span class="Apple-converted-space">        </span>- 0.1851 * Math.sin(M * D2R)</p>
<p class="p1"><span class="Apple-converted-space">        </span>- 0.1143 * Math.sin(2 * F * D2R);</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Normalize</p>
<p class="p1"><span class="Apple-converted-space">  </span>L = ((L % 360) + 360) % 360;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const signs = [</p>
<p class="p1"><span class="Apple-converted-space">      </span>"牡羊座", "金牛座", "雙子座", "巨蟹座", "獅子座", "處女座",</p>
<p class="p1"><span class="Apple-converted-space">      </span>"天秤座", "天蠍座", "射手座", "摩羯座", "水瓶座", "雙魚座"</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>return signs[Math.floor(L / 30)];</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">const getSunSign = (day, month) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const cutoffs = [20, 19, 21, 20, 21, 21, 23, 23, 23, 23, 22, 22];<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const signs = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>"摩羯座", "水瓶座", "雙魚座", "牡羊座", "金牛座", "雙子座",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>"巨蟹座", "獅子座", "處女座", "天秤座", "天蠍座", "射手座", "摩羯座"</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (day &lt; cutoffs[month - 1]) return signs[month - 1];</p>
<p class="p1"><span class="Apple-converted-space">  </span>else return signs[month];</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// --- 組件 (Components) ---</p>
<p class="p2"><br></p>
<p class="p1">const Button = ({ onClick, children, className = "", disabled = false, secondary = false }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">    </span>onClick={onClick}</p>
<p class="p1"><span class="Apple-converted-space">    </span>disabled={disabled}</p>
<p class="p1"><span class="Apple-converted-space">    </span>className={`px-6 py-3 rounded-xl font-medium transition-all duration-300 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center</p>
<p class="p1"><span class="Apple-converted-space">    </span>${secondary<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>? 'bg-slate-800 text-slate-300 border border-slate-700 hover:bg-slate-700'<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>: 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:from-indigo-500 hover:to-purple-500'}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>${className}`}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>{children}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/button&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">const Card = ({ children, className = "" }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div className={`bg-slate-900/80 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 md:p-8 shadow-2xl ${className}`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>{children}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">// --- 主程式 (Main App) ---</p>
<p class="p2"><br></p>
<p class="p1">export default function FortuneTeller() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [step, setStep] = useState(1);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [userInfo, setUserInfo] = useState({</p>
<p class="p1"><span class="Apple-converted-space">    </span>year: 1995,</p>
<p class="p1"><span class="Apple-converted-space">    </span>month: 6,</p>
<p class="p1"><span class="Apple-converted-space">    </span>day: 15,</p>
<p class="p1"><span class="Apple-converted-space">    </span>hour: 8,</p>
<p class="p1"><span class="Apple-converted-space">    </span>minute: 0</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [selectedMode, setSelectedMode] = useState(null);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [loading, setLoading] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [result, setResult] = useState(null);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// AI 與 Key 狀態</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [userApiKey, setUserApiKey] = useState("");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [aiResult, setAiResult] = useState("");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isAiLoading, setIsAiLoading] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [showKeyInput, setShowKeyInput] = useState(false);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// 塔羅牌狀態</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [tarotState, setTarotState] = useState({</p>
<p class="p1"><span class="Apple-converted-space">    </span>deck: [],</p>
<p class="p1"><span class="Apple-converted-space">    </span>isShuffling: false,</p>
<p class="p1"><span class="Apple-converted-space">    </span>selectedCards: [],</p>
<p class="p1"><span class="Apple-converted-space">    </span>flipped: false</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [resultFlippedState, setResultFlippedState] = useState({});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const scrollContainerRef = useRef(null);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// 初始化讀取 Key</p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const storedKey = localStorage.getItem('gemini_api_key');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (storedKey) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setUserApiKey(storedKey);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, []);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// 儲存 Key</p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleSaveKey = (key) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setUserApiKey(key);</p>
<p class="p1"><span class="Apple-converted-space">      </span>localStorage.setItem('gemini_api_key', key);</p>
<p class="p1"><span class="Apple-converted-space">      </span>setShowKeyInput(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleInputChange = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const { name, value } = e.target;</p>
<p class="p1"><span class="Apple-converted-space">    </span>setUserInfo(prev =&gt; ({ ...prev, [name]: parseInt(value) || 0 }));</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleModeSelect = (mode) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setSelectedMode(mode);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setResult(null);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setAiResult("");</p>
<p class="p1"><span class="Apple-converted-space">    </span>setLoading(true);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'tarot') {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setLoading(false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>setStep(3);</p>
<p class="p1"><span class="Apple-converted-space">        </span>startTarotSession();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, 800);</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>generateResult(mode);</p>
<p class="p1"><span class="Apple-converted-space">        </span>setLoading(false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>setStep(3);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, 1500);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// --- Gemini API Call ---</p>
<p class="p1"><span class="Apple-converted-space">  </span>const fetchAIReading = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!result) return;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 如果沒有 Key，顯示輸入框</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!userApiKey) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setShowKeyInput(true);</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>setIsAiLoading(true);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>let prompt = "";</p>
<p class="p1"><span class="Apple-converted-space">    </span>const systemInstruction = "你是一位名叫「靈靈柒」的專業命理師。你的口吻溫柔、療癒、富有同理心，且充滿神秘感。請用繁體中文回答，針對使用者的情況給予具體、正向且有建設性的指引。";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (result.type === 'tarot') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const cardsStr = result.cards.map((c, i) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const pos = i === 0 ? "過去/現狀" : i === 1 ? "挑戰/障礙" : "未來/建議";</p>
<p class="p1"><span class="Apple-converted-space">            </span>const orientation = c.isReversed ? "逆位" : "正位";</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `${pos}: ${c.name} (${orientation})`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}).join(", ");</p>
<p class="p1"><span class="Apple-converted-space">        </span>prompt = `使用者抽到了這三張塔羅牌：${cardsStr}。請針對這三張牌的組合，為使用者進行深度的綜合解牌。請包含對事業、愛情、健康的具體建議，並給予一段溫暖的總結。`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else if (result.type === 'astro') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>prompt = `使用者的太陽星座是${result.sign}，月亮星座是${result.moon}，上升星座是${result.rising}。請根據這三個星座的黃金三角特質，深度分析使用者的人格與近期運勢（包含事業、愛情、健康），並給予一些心靈成長的建議。`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else if (result.type === 'bazi') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>prompt = `使用者的八字年柱為${result.main}，本命五行屬${result.element}。請根據五行生剋原理，分析使用者今年的流年運勢，並在事業、人際關係與健康方面給予建議。`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, {</p>
<p class="p1"><span class="Apple-converted-space">            </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">            </span>headers: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>'Content-Type': 'application/json',</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>body: JSON.stringify({</p>
<p class="p1"><span class="Apple-converted-space">                </span>contents: [{</p>
<p class="p1"><span class="Apple-converted-space">                    </span>parts: [{ text: prompt }]</p>
<p class="p1"><span class="Apple-converted-space">                </span>}],</p>
<p class="p1"><span class="Apple-converted-space">                </span>systemInstruction: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>parts: [{ text: systemInstruction }]</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>})</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const data = await response.json();</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (data.error) {</p>
<p class="p1"><span class="Apple-converted-space">             </span>setAiResult(`錯誤：${data.error.message}。請檢查您的 API Key 是否正確。`);</p>
<p class="p1"><span class="Apple-converted-space">             </span>setShowKeyInput(true); // 讓使用者有機會修正</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (data.candidates &amp;&amp; data.candidates[0].content) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>setAiResult(data.candidates[0].content.parts[0].text);</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>setAiResult("抱歉，靈靈柒暫時無法連結到宇宙資料庫，請稍後再試。");</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.error("AI Error:", error);</p>
<p class="p1"><span class="Apple-converted-space">        </span>setAiResult("連線發生錯誤，請檢查網路狀態或 API Key。");</p>
<p class="p1"><span class="Apple-converted-space">    </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setIsAiLoading(false);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const generateResult = (mode) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === 'bazi') {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const baziData = calculateBazi(userInfo.year, userInfo.month, userInfo.day);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const elementTraits = {</p>
<p class="p1"><span class="Apple-converted-space">        </span>"木": "正直仁慈，具生長力，適合發展文教或創作。",</p>
<p class="p1"><span class="Apple-converted-space">        </span>"火": "熱情有禮，行動力強，適合領導與公眾事務。",</p>
<p class="p1"><span class="Apple-converted-space">        </span>"土": "誠信穩重，包容力強，適合管理與不動產。",</p>
<p class="p1"><span class="Apple-converted-space">        </span>"金": "剛毅果決，講求原則，適合金融與法律。",</p>
<p class="p1"><span class="Apple-converted-space">        </span>"水": "聰明靈活，適應力強，適合貿易與服務業。"</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>setResult({</p>
<p class="p1"><span class="Apple-converted-space">        </span>type: 'bazi',</p>
<p class="p1"><span class="Apple-converted-space">        </span>title: '【 八字命盤解析 】',</p>
<p class="p1"><span class="Apple-converted-space">        </span>main: `${baziData.stem.char}${baziData.branch} (${baziData.animal}年)`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>element: baziData.stem.element,</p>
<p class="p1"><span class="Apple-converted-space">        </span>prediction: `【命造分析】</p>
<p class="p1"><span class="Apple-converted-space">        </span>親愛的，您的本命元神為「${baziData.stem.char}${baziData.stem.element}」。</p>
<p class="p1"><span class="Apple-converted-space">        </span>${elementTraits[baziData.stem.element]} 這顯示了您內在擁有強大的潛能。</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>【精準流年運算】</p>
<p class="p1"><span class="Apple-converted-space">        </span>系統偵測到您的出生年份 ${baziData.realYear} (若您的生日在立春前，已自動校正為上一年)。</p>
<p class="p1"><span class="Apple-converted-space">        </span>今年流年氣場顯示，您可能面臨「變動中求穩」的局勢。天干${baziData.stem.char}木與流年氣場產生互動，建議您在${userInfo.month}月左右多注意職場上的人際變化。記得，穩住自己的心，外在的風雨就無法撼動您。`</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>} else if (mode === 'astro') {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const sunSign = getSunSign(userInfo.day, userInfo.month);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const risingSign = calculateRisingSign(userInfo.year, userInfo.month, userInfo.day, userInfo.hour, userInfo.minute);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const moonSign = calculateMoonSign(userInfo.year, userInfo.month, userInfo.day, userInfo.hour, userInfo.minute);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>setResult({</p>
<p class="p1"><span class="Apple-converted-space">        </span>type: 'astro',</p>
<p class="p1"><span class="Apple-converted-space">        </span>title: '【 星盤運勢掃描 】',</p>
<p class="p1"><span class="Apple-converted-space">        </span>sign: sunSign,</p>
<p class="p1"><span class="Apple-converted-space">        </span>rising: risingSign,</p>
<p class="p1"><span class="Apple-converted-space">        </span>moon: moonSign,</p>
<p class="p1"><span class="Apple-converted-space">        </span>prediction: `【星盤數據校正】</p>
<p class="p1"><span class="Apple-converted-space">        </span>系統採用真太陽時 (LST) 與天文球面三角演算法，並針對台灣經緯度 (121.5°E, 25.0°N) 進行精密校正。</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>☀️ 太陽星座：${sunSign}</p>
<p class="p1"><span class="Apple-converted-space">        </span>這是您的「核心人格」，代表您追求的人生目標與活力來源。</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>🏹 上升星座：${risingSign}</p>
<p class="p1"><span class="Apple-converted-space">        </span>這是您的「人格面具」，決定了別人對您的第一印象、外貌氣質，以及您面對世界的方式。</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>🌙 月亮星座：${moonSign}</p>
<p class="p1"><span class="Apple-converted-space">        </span>這是您的「內在小孩」，掌管著您的情緒、安全感來源以及潛意識的反應模式。</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>【綜合指引】</p>
<p class="p1"><span class="Apple-converted-space">        </span>太陽${sunSign}賦予您追求目標的動力，而月亮${moonSign}則影響著您的內心感受。近期您可能會感受到來自內在的拉扯，請試著平衡這兩股能量，並善用上升${risingSign}的特質來化解外界的壓力。`</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const startTarotSession = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const deck = [...TAROT_DECK];</p>
<p class="p1"><span class="Apple-converted-space">    </span>setTarotState({</p>
<p class="p1"><span class="Apple-converted-space">      </span>deck: deck,</p>
<p class="p1"><span class="Apple-converted-space">      </span>isShuffling: true,</p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedCards: [],</p>
<p class="p1"><span class="Apple-converted-space">      </span>flipped: false</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>setResultFlippedState({});</p>
<p class="p1"><span class="Apple-converted-space">    </span>setAiResult("");</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>for (let i = deck.length - 1; i &gt; 0; i--) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const j = Math.floor(Math.random() * (i + 1));</p>
<p class="p1"><span class="Apple-converted-space">            </span>[deck[i], deck[j]] = [deck[j], deck[i]];</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>setTarotState(prev =&gt; ({ ...prev, deck: deck, isShuffling: false }));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}, 2000);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleCardClick = (index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (tarotState.selectedCards.length &gt;= 3 || tarotState.selectedCards.some(c =&gt; c.index === index)) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const isReversed = Math.random() &gt; 0.5;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const newSelection = [...tarotState.selectedCards, { index, isReversed }];</p>
<p class="p1"><span class="Apple-converted-space">    </span>setTarotState(prev =&gt; ({ ...prev, selectedCards: newSelection }));</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleReveal = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setTarotState(prev =&gt; ({ ...prev, flipped: true }));</p>
<p class="p1"><span class="Apple-converted-space">    </span>setResultFlippedState({});</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const selectedData = tarotState.selectedCards.map(item =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">        </span>...tarotState.deck[item.index],</p>
<p class="p1"><span class="Apple-converted-space">        </span>isReversed: item.isReversed</p>
<p class="p1"><span class="Apple-converted-space">    </span>}));</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>setResult({</p>
<p class="p1"><span class="Apple-converted-space">      </span>type: 'tarot',</p>
<p class="p1"><span class="Apple-converted-space">      </span>title: '【 塔羅指引 】',</p>
<p class="p1"><span class="Apple-converted-space">      </span>cards: selectedData,</p>
<p class="p1"><span class="Apple-converted-space">      </span>prediction: ""<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (result?.type === 'tarot') {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const timers = [];</p>
<p class="p1"><span class="Apple-converted-space">      </span>timers.push(setTimeout(() =&gt; setResultFlippedState(prev =&gt; ({ ...prev, 0: true })), 600));</p>
<p class="p1"><span class="Apple-converted-space">      </span>timers.push(setTimeout(() =&gt; setResultFlippedState(prev =&gt; ({ ...prev, 1: true })), 1400));</p>
<p class="p1"><span class="Apple-converted-space">      </span>timers.push(setTimeout(() =&gt; setResultFlippedState(prev =&gt; ({ ...prev, 2: true })), 2200));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>return () =&gt; timers.forEach(t =&gt; clearTimeout(t));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [result]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const toggleResultCardFlip = (idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setResultFlippedState(prev =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">        </span>...prev,</p>
<p class="p1"><span class="Apple-converted-space">        </span>[idx]: !prev[idx]</p>
<p class="p1"><span class="Apple-converted-space">    </span>}));</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const renderCardBackContent = (card) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">     </span>if (card.type === 'major') {</p>
<p class="p1"><span class="Apple-converted-space">         </span>return &lt;span className={`text-2xl font-serif text-white ${card.isReversed ? 'rotate-180' : ''}`}&gt;{card.id}&lt;/span&gt;;</p>
<p class="p1"><span class="Apple-converted-space">     </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">         </span>const IconMap = {</p>
<p class="p1"><span class="Apple-converted-space">             </span>'Wands': Flame,</p>
<p class="p1"><span class="Apple-converted-space">             </span>'Cups': Droplets,</p>
<p class="p1"><span class="Apple-converted-space">             </span>'Swords': Wind,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>'Pentacles': Mountain</p>
<p class="p1"><span class="Apple-converted-space">         </span>};</p>
<p class="p1"><span class="Apple-converted-space">         </span>const suitTypeMap = { '權杖': 'Wands', '聖杯': 'Cups', '寶劍': 'Swords', '錢幣': 'Pentacles' };</p>
<p class="p1"><span class="Apple-converted-space">         </span>const type = suitTypeMap[card.suit];</p>
<p class="p1"><span class="Apple-converted-space">         </span>const FinalIcon = type ? IconMap[type] : Star;</p>
<p class="p2"><span class="Apple-converted-space">         </span></p>
<p class="p1"><span class="Apple-converted-space">         </span>return &lt;FinalIcon className={`w-8 h-8 text-indigo-200 ${card.isReversed ? 'rotate-180' : ''}`} /&gt;;</p>
<p class="p1"><span class="Apple-converted-space">     </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className="min-h-screen bg-slate-950 text-slate-200 font-sans selection:bg-indigo-500 selection:text-white pb-12"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="fixed inset-0 overflow-hidden pointer-events-none z-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] bg-indigo-900/20 rounded-full blur-[120px]"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-900/20 rounded-full blur-[100px]"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="relative z-10 max-w-4xl mx-auto px-4 py-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;header className="text-center mb-12 animate-fade-in-down"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div onClick={() =&gt; setStep(1)} className="inline-flex cursor-pointer items-center justify-center p-3 bg-indigo-500/10 rounded-full mb-4 ring-1 ring-indigo-400/30 hover:bg-indigo-500/20 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;Sparkles className="w-6 h-6 text-indigo-400 mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;span className="text-indigo-300 font-medium tracking-wider"&gt;靈靈柒 · 命運觀測 v4.9&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;h1 className="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-indigo-100 to-slate-400 mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>探索您的命運軌跡</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;p className="text-slate-400 max-w-lg mx-auto text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>全方位命理系統：整合太陽、月亮、上升星座精準演算，以及完整八字與塔羅解析。</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>{step === 1 &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="max-w-md mx-auto animate-fade-in-up"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;Card&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;h2 className="text-xl font-semibold mb-6 flex items-center text-white"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span className="bg-indigo-600 w-8 h-8 rounded-full flex items-center justify-center text-sm mr-3"&gt;1&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>輸入您的誕生時刻</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div className="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="grid grid-cols-3 gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;div className="space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label className="text-xs text-slate-400"&gt;西元年&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" name="year" value={userInfo.year} onChange={handleInputChange} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-center focus:ring-2 focus:ring-indigo-500 outline-none text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;div className="space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label className="text-xs text-slate-400"&gt;月&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" name="month" min="1" max="12" value={userInfo.month} onChange={handleInputChange} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-center focus:ring-2 focus:ring-indigo-500 outline-none text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;div className="space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label className="text-xs text-slate-400"&gt;日&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" name="day" min="1" max="31" value={userInfo.day} onChange={handleInputChange} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-center focus:ring-2 focus:ring-indigo-500 outline-none text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="grid grid-cols-2 gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                   </span>&lt;div className="space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label className="text-xs text-slate-400"&gt;時 (24h)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" name="hour" min="0" max="23" value={userInfo.hour} onChange={handleInputChange} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-center focus:ring-2 focus:ring-indigo-500 outline-none text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;div className="space-y-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label className="text-xs text-slate-400"&gt;分&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" name="minute" min="0" max="59" value={userInfo.minute} onChange={handleInputChange} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-center focus:ring-2 focus:ring-indigo-500 outline-none text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="flex items-start gap-2 text-xs text-slate-400 mt-2 bg-slate-800/50 p-2 rounded"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;MapPin className="w-4 h-4 text-indigo-400 shrink-0" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span&gt;預設採用台灣/東亞時區 (GMT+8) 進行精密演算，無需手動調整經緯度。&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;Button onClick={() =&gt; setStep(2)} className="w-full mt-4 flex justify-center items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>下一步 &lt;ArrowRight className="w-4 h-4 ml-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/Button&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/Card&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>{step === 2 &amp;&amp; !loading &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="animate-fade-in-up"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className="text-center mb-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h2 className="text-2xl font-semibold text-white"&gt;請選擇您想探索的方向&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p className="text-slate-400 mt-2"&gt;不同的命理工具將提供不同維度的指引&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className="grid md:grid-cols-3 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; handleModeSelect('bazi')} className="group relative bg-slate-900 border border-slate-700 rounded-2xl p-6 hover:bg-slate-800 transition-all hover:scale-105 hover:border-indigo-500/50 text-left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-12 h-12 bg-indigo-900/50 rounded-lg flex items-center justify-center mb-4 group-hover:bg-indigo-600 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;User className="w-6 h-6 text-indigo-300 group-hover:text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 className="text-xl font-bold text-white mb-2"&gt;生辰八字&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p className="text-sm text-slate-400"&gt;整合立春節氣判斷，精準計算年柱干支與五行。&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; handleModeSelect('astro')} className="group relative bg-slate-900 border border-slate-700 rounded-2xl p-6 hover:bg-slate-800 transition-all hover:scale-105 hover:border-purple-500/50 text-left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-12 h-12 bg-purple-900/50 rounded-lg flex items-center justify-center mb-4 group-hover:bg-purple-600 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;Star className="w-6 h-6 text-purple-300 group-hover:text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 className="text-xl font-bold text-white mb-2"&gt;西洋星盤&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p className="text-sm text-slate-400"&gt;使用真太陽時(LST)演算法，大幅提升上升星座準確度。&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;button onClick={() =&gt; handleModeSelect('tarot')} className="group relative bg-slate-900 border border-slate-700 rounded-2xl p-6 hover:bg-slate-800 transition-all hover:scale-105 hover:border-pink-500/50 text-left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="absolute inset-0 bg-gradient-to-br from-pink-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-12 h-12 bg-pink-900/50 rounded-lg flex items-center justify-center mb-4 group-hover:bg-pink-600 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;Sparkles className="w-6 h-6 text-pink-300 group-hover:text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 className="text-xl font-bold text-white mb-2"&gt;塔羅占卜&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p className="text-sm text-slate-400"&gt;78 張完整偉特牌庫，含大、小阿爾克那深度解析。&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">             </span>&lt;div className="mt-8 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button onClick={() =&gt; setStep(1)} className="text-sm text-slate-500 hover:text-white transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>← 返回修改生日</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">             </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>{loading &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="flex flex-col items-center justify-center py-20 animate-fade-in"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className="relative"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-16 h-16 border-4 border-indigo-500/30 border-t-indigo-500 rounded-full animate-spin"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="absolute inset-0 flex items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;Search className="w-6 h-6 text-indigo-400" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p className="mt-6 text-lg text-indigo-200 animate-pulse"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>{selectedMode === 'astro' ? '正在校正真太陽時...' : '正在從資料庫檢索命盤...'}</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>{step === 3 &amp;&amp; selectedMode === 'tarot' &amp;&amp; !result &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">           </span>&lt;div className="animate-fade-in text-center select-none"&gt;</p>
<p class="p1"><span class="Apple-converted-space">               </span>&lt;h3 className="text-2xl font-bold text-white mb-2"&gt;請屏氣凝神，想著您的問題&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">               </span>&lt;p className="text-slate-400 mb-6"&gt;從 78 張牌中直覺選取 3 張（可左右滑動）&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">               </span></p>
<p class="p1"><span class="Apple-converted-space">               </span>&lt;div className="relative w-full max-w-6xl mx-auto h-72 md:h-80 group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div className="absolute left-0 top-0 bottom-0 w-12 z-20 bg-gradient-to-r from-slate-950 to-transparent pointer-events-none flex items-center justify-start opacity-0 group-hover:opacity-100 transition-opacity"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                         </span>&lt;ChevronLeft className="text-white/50 w-8 h-8 animate-pulse ml-1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div className="absolute right-0 top-0 bottom-0 w-12 z-20 bg-gradient-to-l from-slate-950 to-transparent pointer-events-none flex items-center justify-end opacity-0 group-hover:opacity-100 transition-opacity"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                         </span>&lt;ChevronRight className="text-white/50 w-8 h-8 animate-pulse mr-1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>ref={scrollContainerRef}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>className="absolute inset-0 overflow-x-auto overflow-y-visible hide-scrollbar px-4 sm:px-10 py-10 flex items-center space-x-[-4rem] md:space-x-[-3rem]"</p>
<p class="p1"><span class="Apple-converted-space">                        </span>style={{ scrollBehavior: 'smooth' }}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                         </span>&lt;div className="min-w-[2rem] h-full flex-shrink-0"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                         </span>{tarotState.deck.map((card, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const isSelected = tarotState.selectedCards.some(c =&gt; c.index === index);</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>return (</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>key={index}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>onClick={() =&gt; !tarotState.isShuffling &amp;&amp; handleCardClick(index)}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>className={`relative flex-shrink-0 w-20 h-36 md:w-24 md:h-44 rounded-lg cursor-pointer transition-all duration-300 shadow-xl border</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>${isSelected<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>? 'border-yellow-400 shadow-yellow-500/80 ring-2 ring-yellow-400/50 -translate-y-8 md:-translate-y-10 z-[100] scale-110'<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>: 'border-indigo-900/50 shadow-black/50 hover:-translate-y-6 hover:z-[90] hover:scale-105 z-10'</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>${tarotState.isShuffling ? 'animate-shuffle-shake' : ''}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>`}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>style={{</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>background: 'linear-gradient(135deg, #1e1b4b 0%, #312e81 100%)',</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px)',</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>backgroundSize: '6px 6px',</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>transform: isSelected ? 'translateY(-40px) scale(1.1)' : `rotate(${(index % 3 - 1) * 2}deg)`</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="w-full h-full flex items-center justify-center bg-opacity-30 bg-black/10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="w-12 h-12 border border-indigo-400/10 rounded-full flex items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Star className="w-4 h-4 text-indigo-400/20" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                    </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>{isSelected &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="absolute -top-3 -right-2 bg-yellow-500 text-slate-900 text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center shadow-lg animate-bounce"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>{tarotState.selectedCards.findIndex(c =&gt; c.index === index) + 1}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>})}</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                         </span>&lt;div className="min-w-[4rem] h-full flex-shrink-0"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">               </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">               </span>&lt;div className="mt-8 space-y-4 relative z-[20]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                   </span>&lt;p className="text-lg font-medium text-indigo-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                       </span>已選擇 {tarotState.selectedCards.length} / 3 張牌</p>
<p class="p1"><span class="Apple-converted-space">                   </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                   </span>{tarotState.selectedCards.length &gt; 0 &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                       </span>&lt;Button onClick={handleReveal} className="animate-bounce-subtle"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                           </span>&lt;Sparkles className="w-4 h-4 mr-2" /&gt; 揭開命運</p>
<p class="p1"><span class="Apple-converted-space">                       </span>&lt;/Button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                   </span>)}</p>
<p class="p1"><span class="Apple-converted-space">               </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">           </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>{result &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="max-w-3xl mx-auto animate-fade-in-up"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;Card className="relative overflow-hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="text-center mb-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h2 className="text-2xl md:text-3xl font-bold text-white mb-2"&gt;{result.title}&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p className="text-slate-400"&gt;運算完成 (v4.9 Full Astro)&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>{(result.type === 'bazi' || result.type === 'astro') &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{result.type === 'bazi' ? (</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="col-span-1 md:col-span-3 grid grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="bg-slate-800/50 p-4 rounded-xl text-center border border-slate-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;span className="block text-slate-400 text-xs uppercase mb-1"&gt;本命年柱&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;span className="text-xl font-bold text-indigo-300"&gt;{result.main}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="bg-slate-800/50 p-4 rounded-xl text-center border border-slate-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;span className="block text-slate-400 text-xs uppercase mb-1"&gt;五行屬性&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;span className="text-xl font-bold text-white"&gt;{result.element}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>) : (</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="bg-indigo-900/20 p-4 rounded-xl border border-indigo-500/30 flex flex-col items-center text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="bg-indigo-500 rounded-full p-2 mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Sun className="w-5 h-5 text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;h4 className="text-slate-400 text-xs mb-1"&gt;太陽星座&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;p className="text-lg text-white font-bold"&gt;{result.sign}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="bg-purple-900/20 p-4 rounded-xl border border-purple-500/30 flex flex-col items-center text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="bg-purple-500 rounded-full p-2 mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Compass className="w-5 h-5 text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;h4 className="text-slate-400 text-xs mb-1"&gt;上升星座 (LST)&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;p className="text-lg text-white font-bold"&gt;{result.rising}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="bg-pink-900/20 p-4 rounded-xl border border-pink-500/30 flex flex-col items-center text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="bg-pink-500 rounded-full p-2 mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Moon className="w-5 h-5 text-white" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;h4 className="text-slate-400 text-xs mb-1"&gt;月亮星座&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;p className="text-lg text-white font-bold"&gt;{result.moon}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="prose prose-invert max-w-none"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;div className="bg-slate-800/50 p-6 md:p-8 rounded-xl border border-slate-700 leading-relaxed whitespace-pre-line text-slate-300 shadow-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>{result.prediction}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>{result.type === 'tarot' &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div className="space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="grid grid-cols-1 md:grid-cols-3 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{result.cards.map((card, idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>const isFlipped = resultFlippedState[idx];</p>
<p class="p1"><span class="Apple-converted-space">                                </span>return (</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>key={idx}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>className="relative w-full h-96 perspective-1000 cursor-pointer group"</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>onClick={() =&gt; toggleResultCardFlip(idx)}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className={`relative w-full h-full transition-all duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;div className="absolute inset-0 backface-hidden bg-slate-200 text-slate-900 rounded-xl p-5 text-center shadow-lg flex flex-col items-center relative overflow-hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;div className="text-xs font-bold text-slate-500 mb-2 uppercase tracking-wider z-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>{idx === 0 ? "現狀 / 過去" : idx === 1 ? "挑戰 / 障礙" : "未來 / 建議"}</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;div className={`my-4 transition-transform duration-500 ${card.isReversed ? 'rotate-180' : ''}`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                      </span>&lt;div className={`w-24 h-32 bg-indigo-900 rounded-lg flex items-center justify-center mx-auto border-2 border-indigo-400 shadow-inner`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                          </span>{renderCardBackContent(card)}</p>
<p class="p1"><span class="Apple-converted-space">                                                      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;h4 className="font-bold text-xl mb-1 text-indigo-900 z-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                     </span>{card.name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                                     </span>&lt;span className={`text-xs ml-1 px-2 py-0.5 rounded-full text-white ${card.isReversed ? 'bg-red-500' : 'bg-green-600'}`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                         </span>{card.isReversed ? '逆' : '正'}</p>
<p class="p1"><span class="Apple-converted-space">                                                     </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;div className="flex flex-wrap justify-center gap-1 mt-2 mb-3 z-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                     </span>{card.keywords.map(k =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">                                                         </span>&lt;span key={k} className="text-[10px] bg-indigo-100 text-indigo-700 px-1.5 py-0.5 rounded"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                             </span>#{k}</p>
<p class="p1"><span class="Apple-converted-space">                                                         </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                     </span>))}</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;div className="mt-auto text-xs text-indigo-500 flex items-center opacity-70 group-hover:opacity-100 transition-opacity"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>&lt;RotateCcw className="w-3 h-3 mr-1" /&gt; 點擊翻轉查看解釋</p>
<p class="p1"><span class="Apple-converted-space">                                                 </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;div className="absolute inset-0 backface-hidden rotate-y-180 bg-indigo-900 text-white rounded-xl p-6 text-center shadow-lg flex flex-col items-center justify-center border-2 border-indigo-400"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;h4 className="font-bold text-xl mb-4 text-indigo-200 border-b border-indigo-500 pb-2 w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>{card.name} {card.isReversed ? '(逆位)' : '(正位)'}</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;div className="overflow-y-auto max-h-[12rem] pr-1 scrollbar-thin"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>&lt;p className="text-sm leading-7 text-slate-100 italic"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                        </span>"{card.isReversed ? card.desc_rev : card.desc_up}"</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;div className="mt-auto pt-4 text-xs text-indigo-300 flex items-center opacity-70 group-hover:opacity-100 transition-opacity"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                                    </span>&lt;RotateCcw className="w-3 h-3 mr-1" /&gt; 點擊返回</p>
<p class="p1"><span class="Apple-converted-space">                                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>})}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="bg-slate-800/80 p-6 md:p-8 rounded-xl border border-slate-700 shadow-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;h3 className="text-xl font-bold text-white mb-6 text-center border-b border-slate-600 pb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>🔮 靈靈柒的溫柔指引</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;div className="space-y-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div className="grid md:grid-cols-3 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="bg-indigo-900/20 p-5 rounded-lg border border-indigo-500/20 hover:bg-indigo-900/30 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="flex items-center mb-3 text-indigo-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Briefcase className="w-5 h-5 mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;h4 className="font-bold"&gt;事業運途&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;p className="text-sm text-slate-300 leading-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>{result.cards[2].advice_career}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="bg-pink-900/20 p-5 rounded-lg border border-pink-500/20 hover:bg-pink-900/30 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="flex items-center mb-3 text-pink-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Heart className="w-5 h-5 mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;h4 className="font-bold"&gt;愛情關係&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;p className="text-sm text-slate-300 leading-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>{result.cards[2].advice_love}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;div className="bg-green-900/20 p-5 rounded-lg border border-green-500/20 hover:bg-green-900/30 transition-colors"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;div className="flex items-center mb-3 text-green-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;Activity className="w-5 h-5 mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>&lt;h4 className="font-bold"&gt;身心健康&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;p className="text-sm text-slate-300 leading-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>{result.cards[2].advice_health}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div className="text-xs text-slate-500 text-center mt-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>* 以上建議主要基於您的「未來/建議」牌位 ({result.cards[2].name}) 進行深度解析。</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>{/* AI 解析區塊 */}</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="mt-12 bg-gradient-to-r from-indigo-900/40 to-purple-900/40 p-6 rounded-2xl border border-indigo-500/30"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div className="text-center mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h3 className="text-xl font-bold text-white flex items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;Sparkles className="w-5 h-5 text-yellow-400 mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>AI 靈能大師深度解析</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p className="text-sm text-slate-400 mt-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>召喚強大的語言模型，為您進行獨一無二的專屬解讀</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{!aiResult &amp;&amp; !isAiLoading &amp;&amp; !showKeyInput &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="flex flex-col items-center gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                </span>onClick={fetchAIReading}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>className="group relative px-8 py-4 bg-indigo-600 rounded-full text-white font-bold shadow-lg shadow-indigo-500/50 hover:bg-indigo-500 transition-all hover:scale-105 active:scale-95 overflow-hidden"</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:animate-shimmer"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span className="flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;MessageCircle className="w-5 h-5 mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>✨ 請求靈靈柒大師詳解 ✨</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                </span>onClick={() =&gt; setShowKeyInput(true)}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                </span>className="text-xs text-indigo-400 underline hover:text-indigo-300 flex items-center"</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;Settings className="w-3 h-3 mr-1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>設定 Google API Key</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{showKeyInput &amp;&amp; !isAiLoading &amp;&amp; !aiResult &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="max-w-md mx-auto bg-slate-900/80 p-6 rounded-xl border border-indigo-500/50 animate-fade-in"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div className="mb-4 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div className="inline-flex p-3 bg-indigo-500/20 rounded-full mb-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;Key className="w-6 h-6 text-indigo-400" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;h4 className="text-lg font-bold text-white mb-2"&gt;請輸入 Google API Key&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;p className="text-xs text-slate-400"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>為了啟動 AI 靈能大師，您需要提供自己的 Gemini API Key。&lt;br/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>(您的 Key 僅儲存於本地瀏覽器，不會傳送至其他伺服器)</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div className="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;input<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>type="password"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>placeholder="貼上您的 API Key (AIza...)"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>className="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm"</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>value={userApiKey}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>onChange={(e) =&gt; setUserApiKey(e.target.value)}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>/&gt;</p>
<p class="p2"><span class="Apple-converted-space">                                </span></p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;div className="flex gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;button<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>onClick={() =&gt; handleSaveKey(userApiKey)}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>className="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white font-medium py-2 rounded-lg transition-colors text-sm"</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>儲存並開始解析</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;a<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>href="https://aistudio.google.com/app/apikey"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>target="_blank"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                        </span>rel="noopener noreferrer"</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>className="flex items-center justify-center px-4 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg transition-colors text-sm"</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>申請 Key &lt;ExternalLink className="w-3 h-3 ml-1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;button<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>onClick={() =&gt; setShowKeyInput(false)}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>className="w-full text-xs text-slate-500 hover:text-slate-300 mt-2"</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>取消</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{isAiLoading &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="flex flex-col items-center justify-center py-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div className="w-12 h-12 border-4 border-indigo-400 border-t-transparent rounded-full animate-spin mb-4"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p className="text-indigo-300 animate-pulse"&gt;正在連結宇宙資料庫，請稍候...&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>{aiResult &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div className="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div className="bg-slate-900/60 p-6 rounded-xl border border-slate-700 text-slate-200 leading-relaxed whitespace-pre-wrap animate-fade-in"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>{aiResult}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div className="text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;button<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                                    </span>onClick={() =&gt; { setAiResult(""); setShowKeyInput(false); }}</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>className="text-xs text-indigo-400 hover:text-indigo-200 underline"</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>重新解析 / 修改 Key</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="mt-12 flex justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;Button secondary onClick={() =&gt; { setStep(2); setResult(null); setTarotState(p=&gt;({...p, selectedCards:[], flipped: false})) }}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;RotateCcw className="w-4 h-4 mr-2" /&gt; 重新選擇方向</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/Button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/Card&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;style&gt;{`</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Hide scrollbar for Chrome, Safari and Opera */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hide-scrollbar::-webkit-scrollbar {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Hide scrollbar for IE, Edge and Firefox */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hide-scrollbar {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-ms-overflow-style: none;<span class="Apple-converted-space">  </span>/* IE and Edge */</p>
<p class="p1"><span class="Apple-converted-space">            </span>scrollbar-width: none;<span class="Apple-converted-space">  </span>/* Firefox */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* 3D Flip Styles */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.perspective-1000 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>perspective: 1000px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.transform-style-3d {</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform-style: preserve-3d;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.backface-hidden {</p>
<p class="p1"><span class="Apple-converted-space">            </span>backface-visibility: hidden;</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-backface-visibility: hidden; /* Safari */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.rotate-y-180 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: rotateY(180deg);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes fadeInDown {</p>
<p class="p1"><span class="Apple-converted-space">            </span>from { opacity: 0; transform: translateY(-20px); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>to { opacity: 1; transform: translateY(0); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes fadeInUp {</p>
<p class="p1"><span class="Apple-converted-space">            </span>from { opacity: 0; transform: translateY(20px); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>to { opacity: 1; transform: translateY(0); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes shimmer {</p>
<p class="p1"><span class="Apple-converted-space">            </span>100% { transform: translateX(100%); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.animate-shimmer {</p>
<p class="p1"><span class="Apple-converted-space">            </span>animation: shimmer 1.5s infinite;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.animate-fade-in-down { animation: fadeInDown 0.8s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.animate-fade-in-up { animation: fadeInUp 0.8s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.animate-fade-in { animation: fadeInUp 0.5s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.animate-shuffle-shake { animation: shuffleShake 0.2s infinite; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>`}&lt;/style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">}</p>
</body>
</html>
